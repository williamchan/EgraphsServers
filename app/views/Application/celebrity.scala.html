@(celebrity:models.Celebrity, products: Iterable[models.Product])

@import libs.Finance.TypeConversions._
@import models.Product

@content_base(title=celebrity.publicName.get + " - eGraphs", onLoad=onLoad, body=body)

@onLoad = {
  $(function () {
    $("a[rel=popover]")
      .popover({
        offset: 10,
        placement: 'above'
      })
      .click(function(e) {
        e.preventDefault()
      })
  })
}

@body = {
  <div class="celeb-content">
    <div class="row personal-info">
      <div class="span4 profile-photo" >
        <img src="@celebrity.profilePhoto.get.url" alt="@celebrity.publicName Profile Photo"/>
      </div>
      <div class="span12 profile-info">
        <h1>@celebrity.publicName <span class="label notice">Currently signing</span></h1>
        <div class="quotemark">&ldquo;</div>
        <div class="row">
          <div class="span11 description">@celebrity.description</div>
        </div>
      </div>
    </div>
    <div class="page-header"></div>
    <div class="products">
      @if(products.headOption == None) {
        <h2>@celebrity.publicName isn't signing eGraphs! Go badger him on Twitter.</h2>
      } else {
        <h2>
          You choose a photo and write a short note.
          <a href="#" rel='popover' title="Just between @celebrity.publicName and you" data-content="When you buy an eGraph, a special slot of time on @celebrity.publicName's schedule gets reserved for him to hand-write a response to your note on top of the photo you select here.">
            @celebrity.publicName does the rest.
          </a>
        </h2>
        @products.toList.grouped(2).map { productRow =>
          <div class="row">
            @productRow.map { product =>
              @_product(product, productRow)
            }
          </div>
        }.toList
      }
    </div>
  </div>

  @_product(product: Product, productRow: List[Product]) = {
    <div class="span6 offset1 @_offsetClass">
      <a class="product preview-link" href="/@celebrity.urlSlug/@product.urlSlug">
        <img src="http://placehold.it/330x230" alt="@product.name Thumbnail">
        <div class="description">
          @product.name
        </div>
        <div class="btn primary large success buy-button" >
          <div>Get it signed!</div>
          <div>@product.price.formatSimply</div>
        </div>
      </a>
    </div>

    @_offsetClass = {
      @((productRow.head, productRow.tail) match {
        case (aProduct, List()) if aProduct == product =>
          "offset5"

        case (aProduct, _) if aProduct == product =>
          "offset1"

        case (_, List(aProduct)) if aProduct == product =>
          "offset2"
      })
    }
  }
}
