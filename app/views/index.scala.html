@(metrics: List[collections.EgraphsMetric[Int]])

@main(title = "Monitoring") {
  
  <table>
  <ul>
         @metrics.map { case collections.EgraphsMetric(name, description, values) =>
           <li>
             <h1> Recent GET requests to @name: </h1>
             <p> @values.mkString(", ") </p>

             <div id="placeholder-@name" style="width:33%;height:300px;"></div>
           </li>
     } 
  </ul>
  </table>

	<script type="text/javascript">
	$(function () {
		Egraphs.drawGraph(0);
		Egraphs.drawGraph(1);
		Egraphs.drawGraph(2);
	});

	var Egraphs = Egraphs || {}

	Egraphs.drawGraph = function (index) {
	  
	  // set up graph display options
	  var options = {
			lines: { show: true },
			points: { show: true },
			xaxis: { tickDecimals: 0, tickSize: 5 },
			yaxis: { min: 0.0, max: 1.2 }
		};

		function updateGraph() {

			function onDataReceived(series) {

				var newData = series.metrics[index].values;
				var newDataTransformed = new Array(newData.length);

				for (var i=0; i<newData.length; i++) {
					newDataTransformed[i] = new Array(i+1, newData[i]);
				}
				
				var pageName = series.metrics[index].name;
        var placeholder = $("#placeholder-" + pageName);
        
				$.plot(placeholder, [ newDataTransformed ], options);
			};

			$.ajax({
				url: "/metrics",
				method: 'GET',
				dataType: 'json',
				success: onDataReceived
			});
		};
		
		updateGraph;
		setInterval(updateGraph, 10000);
		//setInterval(updateGraph, 60000);	
	};

	</script>  
}