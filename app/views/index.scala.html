@(metrics: List[collections.EgraphsMetric[Int]])

@main(title = "Monitoring") {

	<ul>
       @metrics.map { case collections.EgraphsMetric(name, description, values) =>
         <li>
           <h1> Recent GET requests to @name: </h1>
           <p> @values.mkString(", ") </p>
           <div id="placeholder" style="width:600px;height:300px;"></div>
         </li>
		}	
	</ul>

	<script type="text/javascript">
	$(function () {
		Egraphs.drawGraph(0);
	});

	var Egraphs = Egraphs || {}

	Egraphs.drawGraph = function (index) {
		var options = {
			lines: { show: true },
			points: { show: true },
			xaxis: { tickDecimals: 0, tickSize: 1 },
			yaxis: { min: 0.0, max: 1.2 }
		};
		var placeholder = $("#placeholder");
		var data = [];

		$.plot(placeholder, data, options);

		function updateGraph() {

			function onDataReceived(series) {

				var newData = series.metrics[index].dataPoints;
				var newDataTransformed = new Array(newData.length);

				for (var i=0; i<newData.length; i++) {
					newDataTransformed[i] = new Array(i+1, newData[i]);
				}
				
				//var newPlaceholder = "placeholder-" + series.metrics[index].sourceName;

				$.plot(placeholder, [ newDataTransformed ], options);

			};

			$.ajax({
				url: "/metrics",
				method: 'GET',
				dataType: 'json',
				success: onDataReceived
			});
		};

		updateGraph;
		setInterval(updateGraph, 10000);
		//setInterval(updateGraph, 60000);	
	};

	</script>  
}